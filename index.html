<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Page Title</title>
  <link href="./style.css" rel="stylesheet"/>
  
</head>

<body>
  <div class="overlay" id="overlay"></div>

  <div class="canvas_container">
    <button class="clickable_canvas" onclick="setCanvasFocus()">
      <canvas id="the_canvas" width="800" height="600" style="border: 1px dotted gray;"></canvas>
    </button>
  </div>
  <div class="controles">
    <div class="lista">
      <h3>Controles</h3>
      Hacer click en el canvas para para manipular la vista. <br>
      Mover el rat√≥n para girar la camara. <br>
      Presionar Q para acercar la camara. <br>
      Presionar E para alejar la camara. <br>
      Presionar ESCAPE para salir del canvas.
      </div>
      <div class="lista">
        <h3>Luz</h3>
        <input type="range" min="0" max="360" value="90" step="0.1" name="rangeX" id="rangeX" oninput="changeLightPosX(value)">
        <label for="rangeX">X</label>
        <br>
        <input type="range" min="-90" max="90" value="45" step="0.1" name="rangeY" id="rangeY" oninput="changeLightPosY(value)">
        <label for="rangeY">Y</label>
      </div>
  </div>
  
</body>
<footer>

  <script id="2d-vertex-shader" type="vertex-shader">
    attribute vec4 a_position;
    attribute vec3 a_normal;
    
    attribute vec2 a_texcoord;

    varying vec2 v_texcoord;

    uniform mat4 u_VM_matrix;
    uniform mat4 u_PVM_matrix;
    
    varying vec3 v_position;
    varying vec3 v_normal;

    void main() {
      v_normal = vec3( u_VM_matrix * vec4(a_normal, 0) );
      v_position = vec3( u_VM_matrix * a_position );
      v_texcoord = a_texcoord;
      gl_Position = u_PVM_matrix * a_position;
    }
  </script>
   
  <script id="2d-fragment-shader" type="fragment-shader">
    precision mediump float;

    //Posicion del fragmento en screenspace
    varying vec3 v_position;
    //normal del fragmento en screenspace
    varying vec3 v_normal;

    //Posicion de luz
    uniform vec3 u_light_position;
    //Color del objeto
    uniform vec4 u_color;
    //Posicion de camara
    uniform vec3 cameraPos;
    //Color de Ambiente
    uniform vec3 ambientColor;

    //texturas
    varying vec2 v_texcoord;
    uniform sampler2D u_texture;
    uniform sampler2D u_normalmap;
    uniform sampler2D u_specularmap;
    void main() {
      
      //Ambiente
      float ambientStrength = 0.3;
      vec3 ambient = ambientStrength * ambientColor;

      //Difusa
      vec3 texNormal = normalize(vec3(texture2D(u_normalmap, v_texcoord)));
      texNormal = vec3(texNormal.x, texNormal.z, texNormal.y);
      
      vec3 norm = normalize(v_normal * texNormal);
      //vec3 lightDir = normalize(u_light_position - v_position);
      vec3 lightDir = normalize(u_light_position);
      float diff = max(dot(norm, lightDir), 0.0);

      vec3 diffuse = diff * vec3(1.0,1.0,1.0) * 1.5;

      //Especular
      float specularStrength = 1.0;
      vec3 viewDir = normalize(cameraPos - v_position);
      vec3 reflectDir = reflect(-lightDir, norm);

      float spec = pow(max(dot(viewDir, reflectDir),0.0), 16.0);
      vec3 specular = specularStrength * spec * vec3(texture2D(u_specularmap, v_texcoord));

      //fresnel
      float fres = 1.0 - dot(norm, vec3(0,0,1));
      vec3 fresnel = fres * ambientColor;

      vec3 result = (ambient + diffuse + fresnel + specular)*vec3(texture2D(u_texture, v_texcoord));

      gl_FragColor = vec4(result, u_color.a);
      //gl_FragColor = texture2D(u_specularmap, v_texcoord);
      //gl_FragColor = vec4(v_texcoord, 0, 1);
    }
  </script>

  <script src="./js/Mesh.js"></script>
  <script src="./js/Vector3.js"></script>
  <script src="./js/Vector4.js"></script>
  <script src="./js/Matrix3.js"></script>
  <script src="./js/Matrix4.js"></script>
  
  <script src="./js/PrismaRectangular.js"></script>
  
  <script src="./js/Cilindro.js"></script>
  <script src="./js/Cono.js"></script>
  <script src="./js/Esfera.js"></script>
  
  <script src="./js/Octaedro.js"></script>
  <script src="./js/Icosaedro.js"></script>
  <script src="./js/Tetraedro.js"></script>
  
  <script src="./js/Dodecaedro.js"></script>
  
  <script src="./js/Toro.js"></script>
  <script src="./js/CamaraCOI.js"></script>
  <script src="./js/LuzDireccional.js"></script>
  <script src="./js/Renderer.js"></script>
  <script src="./js/Main.js"></script>

  
</footer>
</html>